{
  "schemaVersion": "1.0",
  "name": "enhanced-rstest-migration",
  "description": "Migrate packages/enhanced tests from Jest/Vitest to Rstest: update Nx targets and configs, convert Jest APIs, fix async patterns, remove Jest infra, and validate parity.",
  "entry": "task/index.ai.tsx",
  "modules": [
    {
      "id": "index",
      "path": "task/index.ai.tsx",
      "description": "Entrypoint orchestrator that imports and sequences the migration phases, then runs validation commands and writes a final report.",
      "kind": "orchestrator",
      "dependsOn": [
        "repo-scan",
        "nx-targets",
        "rstest-config",
        "tsconfig-spec",
        "jest-api-migration",
        "done-callback-migration",
        "helper-refactors",
        "config-cases",
        "remove-jest-infra",
        "validate"
      ]
    },
    {
      "id": "repo-scan",
      "path": "task/repo-scan.ai.tsx",
      "description": "Inspect current packages/enhanced test infrastructure and capture a file-level inventory (configs, targets, jest-only helpers, and test patterns) for downstream context.",
      "kind": "ai"
    },
    {
      "id": "nx-targets",
      "path": "task/nx-targets.ai.tsx",
      "description": "Update packages/enhanced/project.json to switch enhanced:test to Rstest, and replace/remove test:jest and test:experiments targets or rewrite them as Rstest equivalents.",
      "kind": "ai",
      "dependsOn": ["repo-scan"]
    },
    {
      "id": "rstest-config",
      "path": "task/rstest-config.ai.tsx",
      "description": "Expand packages/enhanced/rstest.config.ts include/exclude coverage, add setupFiles/globalSetup as needed, and optionally split into Rstest projects for fast vs long-running suites.",
      "kind": "ai",
      "dependsOn": ["repo-scan"]
    },
    {
      "id": "tsconfig-spec",
      "path": "task/tsconfig-spec.ai.tsx",
      "description": "Update packages/enhanced/tsconfig.spec.json to use Rstest globals/types (or explicit imports) and remove jest types; ensure TS compilation works for the updated test suite.",
      "kind": "ai",
      "dependsOn": ["repo-scan", "rstest-config"]
    },
    {
      "id": "jest-api-migration",
      "path": "task/jest-api-migration.ai.tsx",
      "description": "Convert Jest APIs in packages/enhanced/test/** to Rstest equivalents (rs.fn/spyOn/mock/etc), update imports/types, and rework patterns without direct equivalents (e.g., isolateModules).",
      "kind": "ai",
      "dependsOn": ["repo-scan", "rstest-config", "tsconfig-spec"]
    },
    {
      "id": "done-callback-migration",
      "path": "task/done-callback-migration.ai.tsx",
      "description": "Remove callback-style done usage across tests/helpers and convert to async/Promise patterns compatible with Rstest.",
      "kind": "ai",
      "dependsOn": ["repo-scan"]
    },
    {
      "id": "helper-refactors",
      "path": "task/helper-refactors.ai.tsx",
      "description": "Refactor Jest-dependent helpers (e.g., test/helpers/webpackMocks.ts, createLazyTestEnv.js) to be Rstest-native or remove them when unused.",
      "kind": "ai",
      "dependsOn": ["repo-scan", "jest-api-migration"]
    },
    {
      "id": "config-cases",
      "path": "task/config-cases.ai.tsx",
      "description": "Ensure config-case runners (ConfigTestCases.*) are executed under Rstest without duplicate runs; reconcile template/basictest/embedruntime artifacts with the existing ConfigTestCases.rstest.ts harness.",
      "kind": "ai",
      "dependsOn": ["repo-scan", "rstest-config", "jest-api-migration"]
    },
    {
      "id": "remove-jest-infra",
      "path": "task/remove-jest-infra.ai.tsx",
      "description": "Remove or deprecate Jest-only configs and scripts in packages/enhanced (jest.config.ts, jest.embed.ts, patch-node-env.js) once the suite is fully on Rstest.",
      "kind": "ai",
      "dependsOn": ["nx-targets", "jest-api-migration", "config-cases"]
    },
    {
      "id": "validate",
      "path": "task/validate.ai.tsx",
      "description": "Run Rstest listing and execution commands (rstest list/run) plus any necessary typecheck/build checks; record failures and produce a validation report for the orchestrator.",
      "kind": "shell",
      "dependsOn": [
        "nx-targets",
        "rstest-config",
        "tsconfig-spec",
        "jest-api-migration",
        "done-callback-migration",
        "helper-refactors",
        "config-cases",
        "remove-jest-infra"
      ]
    }
  ]
}

