{"version":3,"sources":["/Users/bytedance/WebstormProjects/universe/packages/data-prefetch/src/cli/babel.ts"],"sourcesContent":["// no used now\nimport path from 'path';\nimport type { moduleFederationPlugin } from '@module-federation/sdk';\n\nconst attribute = 'id';\nconst hookId = 'usePrefetch';\nconst importPackage = '@module-federation/data-prefetch/react';\n\ninterface BabelPluginOptions {\n  hook_id: string;\n  import_pkg: string;\n  attribute: string;\n  name: string;\n  exposes: moduleFederationPlugin.ModuleFederationPluginOptions['exposes'];\n}\n\n// biome-ignore lint/suspicious/noExplicitAny: <explanation>\nexport default (babel: { types: any }, options: BabelPluginOptions) => {\n  const t = babel.types;\n  let shouldHandle = false;\n  let scope = '';\n  const { name, exposes } = options;\n  if (!exposes) {\n    return {};\n  }\n  const exposesKey = Object.keys(exposes);\n  const processedExposes = exposesKey.map((expose) => ({\n    key: expose.replace('.', ''),\n    value: path.resolve(\n      // @ts-ignore\n      typeof exposes[expose] === 'string'\n        ? // @ts-ignore\n          exposes[expose]\n        : // @ts-ignore\n          exposes[expose].import,\n    ),\n  }));\n\n  return {\n    visitor: {\n      ImportDeclaration(\n        nodePath: {\n          // biome-ignore lint/suspicious/noExplicitAny: <explanation>\n          node: { source: { value: any }; specifiers: any };\n        },\n        // biome-ignore lint/suspicious/noExplicitAny: <explanation>\n        state: { file: { opts: { filename: any } } },\n      ) {\n        const source = nodePath.node.source.value;\n        const { specifiers } = nodePath.node;\n        const { filename } = state.file.opts;\n\n        if (source === importPackage) {\n          shouldHandle = specifiers.some(\n            (specifier: { imported: { name: string } }) =>\n              specifier.imported &&\n              specifier.imported.name === hookId &&\n              processedExposes.find(\n                // biome-ignore lint/suspicious/noAssignInExpressions: <explanation>\n                (expose) => expose.value === filename && (scope = expose.key),\n              ),\n          );\n        }\n      },\n\n      CallExpression(nodePath: {\n        // biome-ignore lint/suspicious/noExplicitAny: <explanation>\n        node: { callee: any; arguments: string | any[] };\n      }) {\n        if (\n          shouldHandle &&\n          t.isIdentifier(nodePath.node.callee, { name: hookId }) &&\n          nodePath.node.arguments.length > 0\n        ) {\n          const objectExpression = nodePath.node.arguments[0];\n          if (\n            objectExpression &&\n            t.isObjectExpression(objectExpression) &&\n            !objectExpression.properties.find(\n              (p: { key: { name: string } }) => p.key.name === attribute,\n            )\n          ) {\n            objectExpression.properties.push(\n              t.objectProperty(\n                t.identifier(attribute),\n                t.stringLiteral(name + scope),\n              ),\n            );\n          }\n        }\n      },\n    },\n  };\n};\n"],"names":["attribute","hookId","importPackage","babel","options","t","types","shouldHandle","scope","name","exposes","exposesKey","Object","keys","processedExposes","map","expose","key","replace","value","path","resolve","import","visitor","ImportDeclaration","nodePath","state","source","node","specifiers","filename","file","opts","some","specifier","imported","find","CallExpression","isIdentifier","callee","arguments","length","objectExpression","isObjectExpression","properties","p","push","objectProperty","identifier","stringLiteral"],"mappings":"AAAA,cAAc;;;;;+BAgBd,4DAA4D;AAC5D;;;eAAA;;;6DAhBiB;;;;;;AAGjB,MAAMA,YAAY;AAClB,MAAMC,SAAS;AACf,MAAMC,gBAAgB;MAWtB,WAAe,CAACC,OAAuBC;IACrC,MAAMC,IAAIF,MAAMG,KAAK;IACrB,IAAIC,eAAe;IACnB,IAAIC,QAAQ;IACZ,MAAM,EAAEC,IAAI,EAAEC,OAAO,EAAE,GAAGN;IAC1B,IAAI,CAACM,SAAS;QACZ,OAAO,CAAC;IACV;IACA,MAAMC,aAAaC,OAAOC,IAAI,CAACH;IAC/B,MAAMI,mBAAmBH,WAAWI,GAAG,CAAC,CAACC,SAAY,CAAA;YACnDC,KAAKD,OAAOE,OAAO,CAAC,KAAK;YACzBC,OAAOC,aAAI,CAACC,OAAO,CACjB,aAAa;YACb,OAAOX,OAAO,CAACM,OAAO,KAAK,WAEvBN,OAAO,CAACM,OAAO,GAEfN,OAAO,CAACM,OAAO,CAACM,MAAM;QAE9B,CAAA;IAEA,OAAO;QACLC,SAAS;YACPC,mBACEC,QAGC,EACD,4DAA4D;YAC5DC,KAA4C;gBAE5C,MAAMC,SAASF,SAASG,IAAI,CAACD,MAAM,CAACR,KAAK;gBACzC,MAAM,EAAEU,UAAU,EAAE,GAAGJ,SAASG,IAAI;gBACpC,MAAM,EAAEE,QAAQ,EAAE,GAAGJ,MAAMK,IAAI,CAACC,IAAI;gBAEpC,IAAIL,WAAWzB,eAAe;oBAC5BK,eAAesB,WAAWI,IAAI,CAC5B,CAACC,YACCA,UAAUC,QAAQ,IAClBD,UAAUC,QAAQ,CAAC1B,IAAI,KAAKR,UAC5Ba,iBAAiBsB,IAAI,CACnB,oEAAoE;wBACpE,CAACpB,SAAWA,OAAOG,KAAK,KAAKW,YAAatB,CAAAA,QAAQQ,OAAOC,GAAG,AAAD;gBAGnE;YACF;YAEAoB,gBAAeZ,QAGd;gBACC,IACElB,gBACAF,EAAEiC,YAAY,CAACb,SAASG,IAAI,CAACW,MAAM,EAAE;oBAAE9B,MAAMR;gBAAO,MACpDwB,SAASG,IAAI,CAACY,SAAS,CAACC,MAAM,GAAG,GACjC;oBACA,MAAMC,mBAAmBjB,SAASG,IAAI,CAACY,SAAS,CAAC,EAAE;oBACnD,IACEE,oBACArC,EAAEsC,kBAAkB,CAACD,qBACrB,CAACA,iBAAiBE,UAAU,CAACR,IAAI,CAC/B,CAACS,IAAiCA,EAAE5B,GAAG,CAACR,IAAI,KAAKT,YAEnD;wBACA0C,iBAAiBE,UAAU,CAACE,IAAI,CAC9BzC,EAAE0C,cAAc,CACd1C,EAAE2C,UAAU,CAAChD,YACbK,EAAE4C,aAAa,CAACxC,OAAOD;oBAG7B;gBACF;YACF;QACF;IACF;AACF"}