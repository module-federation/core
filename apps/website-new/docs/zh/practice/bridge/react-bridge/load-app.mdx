# åŠ è½½åº”ç”¨

æœ¬ç« å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ `createRemoteAppComponent` åœ¨å®¿ä¸»åº”ç”¨ä¸­åŠ è½½å’Œé›†æˆè¿œç¨‹ React åº”ç”¨ã€‚

## ä»€ä¹ˆæ˜¯ createRemoteAppComponentï¼Ÿ

`createRemoteAppComponent` æ˜¯ React Bridge çš„æ ¸å¿ƒ APIï¼Œç”¨äºåœ¨å®¿ä¸»åº”ç”¨ä¸­åŠ è½½è¿œç¨‹ React åº”ç”¨ã€‚å®ƒå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š

- **ğŸš€ è‡ªåŠ¨æ‡’åŠ è½½** - è¿œç¨‹åº”ç”¨ä¼šåœ¨éœ€è¦æ—¶æ‰å¼€å§‹åŠ è½½
- **ğŸ”§ ç”Ÿå‘½å‘¨æœŸç®¡ç†** - è‡ªåŠ¨å¤„ç†ç»„ä»¶çš„æŒ‚è½½å’Œå¸è½½
- **ğŸ›£ï¸ è·¯ç”±é›†æˆ** - æ— ç¼é›†æˆ React Routerï¼Œæ”¯æŒ basename æ³¨å…¥
- **âš¡ é”™è¯¯å¤„ç†** - å†…ç½®åŠ è½½å¤±è´¥å’Œè¿è¡Œæ—¶é”™è¯¯å¤„ç†æœºåˆ¶
- **ğŸ¨ æ ·å¼éš”ç¦»** - æ”¯æŒç»„ä»¶çº§æ ·å¼å’Œç±»åé…ç½® 


## å®‰è£…

import { PackageManagerTabs } from '@theme';

<PackageManagerTabs
  command={{
    npm: 'npm install @module-federation/bridge-react@latest',
    yarn: 'yarn add @module-federation/bridge-react@latest',
    pnpm: 'pnpm add @module-federation/bridge-react@latest',
  }}
/>
## åŸºæœ¬ä½¿ç”¨

### æ­¥éª¤ 1: é…ç½®è¿œç¨‹æ¨¡å—

åœ¨å®¿ä¸»åº”ç”¨çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæ·»åŠ è¿œç¨‹åº”ç”¨çš„é…ç½®ï¼š

:::tip æ„å»ºå·¥å…·æ”¯æŒ
ä»¥ä¸‹ç¤ºä¾‹ä½¿ç”¨ Rsbuild é…ç½®ï¼Œè¯·æ ¹æ®æ‚¨ä½¿ç”¨çš„æ„å»ºå·¥å…·è¿›è¡Œç›¸åº”è°ƒæ•´ï¼š
- **Rsbuild**: `@module-federation/rsbuild-plugin`
- **Rspack**: `@module-federation/enhanced/rspack`
- **Webpack**: `@module-federation/enhanced/webpack`
- **Vite**: `@module-federation/vite`

:::


```ts
// rsbuild.config.ts
import { pluginModuleFederation } from '@module-federation/rsbuild-plugin';
import { defineConfig } from '@rsbuild/core';

export default defineConfig({
  plugins: [
    pluginModuleFederation({
      name: 'host-app',
      remotes: {
        'remote1': 'remote1@http://localhost:3001/remoteEntry.js',
      },
    }),
  ],
});
```

### æ­¥éª¤ 2: åˆ›å»ºè¿œç¨‹ç»„ä»¶

#### 2.1 å®šä¹‰åŠ è½½å’Œé”™è¯¯ç»„ä»¶

é¦–å…ˆï¼Œåˆ›å»ºåŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†ç»„ä»¶ï¼š

```tsx
// ./src/components/RemoteComponents.tsx
import React from 'react';

// åŠ è½½çŠ¶æ€ç»„ä»¶
export const LoadingComponent = () => (
  <div style={{ padding: '20px', textAlign: 'center' }}>
    <div>è¿œç¨‹åº”ç”¨åŠ è½½ä¸­...</div>
  </div>
);

// é”™è¯¯å›é€€ç»„ä»¶
export const ErrorFallback = ({ error }: { error: Error }) => (
  <div style={{ padding: '20px', border: '1px solid #ff6b6b', borderRadius: '8px' }}>
    <h3>è¿œç¨‹åº”ç”¨åŠ è½½å¤±è´¥</h3>
    <p>é”™è¯¯è¯¦æƒ…: {error.message}</p>
    <button onClick={() => window.location.reload()}>
      é‡æ–°åŠ è½½é¡µé¢
    </button>
  </div>
);
```

#### 2.2 åˆ›å»ºè¿œç¨‹åº”ç”¨ç»„ä»¶

ä½¿ç”¨ `createRemoteAppComponent` åˆ›å»ºè¿œç¨‹ç»„ä»¶ï¼š

```tsx
// ./src/remotes/Remote1App.tsx
import { createRemoteAppComponent } from '@module-federation/bridge-react';
import { loadRemote } from '@module-federation/runtime';
import { LoadingComponent, ErrorFallback } from '../components/RemoteComponents';

export const Remote1App = createRemoteAppComponent({
  loader: () => loadRemote('remote1/export-app'),
  loading: LoadingComponent,
  fallback: ErrorFallback,
});
```

#### 2.3 ä¸»åº”ç”¨è·¯ç”±é…ç½®

åœ¨ä¸»åº”ç”¨ä¸­é…ç½®è·¯ç”±ï¼š

```tsx
// ./src/App.tsx
import React from 'react';
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import { Remote1App } from './remotes/Remote1App';

// å®¿ä¸»åº”ç”¨é¦–é¡µç»„ä»¶
const HomePage = () => (
  <div style={{ padding: '20px' }}>
    <h1>å®¿ä¸»åº”ç”¨é¦–é¡µ</h1>
    <p>è¿™æ˜¯å®¿ä¸»åº”ç”¨çš„é¦–é¡µå†…å®¹</p>
  </div>
);

const App = () => {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<HomePage />} />
        <Route
          path="/remote1/*"
          // ä½¿ç”¨ Remote1App ç»„ä»¶, å°†ä¼šè¢«æ‡’åŠ è½½
          Component={() => (
            <Remote1App
              // å¯è®¾ç½® className å’Œ style æ ·å¼ï¼Œå°†è‡ªåŠ¨æ³¨å…¥åˆ°ç»„ä»¶ä¸Š
              className={styles.remote1}
              style={{ color: 'red' }}
              // name å’Œ age ä¸ºè¿œç¨‹ç»„ä»¶ props, å°†è‡ªåŠ¨é€ä¼ åˆ°è¿œç¨‹ç»„ä»¶
              name={'Ming'}
              age={12}
              // å¯è®¾ç½® ref, å°†è‡ªåŠ¨è½¬å‘åˆ°è¿œç¨‹ç»„ä»¶ï¼Œå¯è·å– ref å¯¹è±¡æ“ä½œ dom
              ref={ref}
            />
          )}
        />
      </Routes>
    </BrowserRouter>
  );
};

export default App;
```

## è¿œç¨‹ç»„ä»¶ Props

### è·¯ç”±ç›¸å…³å±æ€§

- **`basename`**: è®¾ç½®è¿œç¨‹åº”ç”¨çš„åŸºç¡€è·¯å¾„
- **`memoryRoute`**: å†…å­˜è·¯ç”±é…ç½®ï¼Œç”¨äºå°†å­åº”ç”¨è·¯ç”±ä½œä¸º memoryRouter æ§åˆ¶

### æ ·å¼å±æ€§

- **`style`**: React.CSSProperties - è®¾ç½®ç»„ä»¶æ ·å¼
- **`className`**: string - è®¾ç½®ç»„ä»¶ç±»å

### å¼•ç”¨æ”¯æŒ

- **`ref`**: React.Ref\<HTMLDivElement\> - è½¬å‘å¼•ç”¨åˆ°å†…éƒ¨å®¹å™¨å…ƒç´ ï¼Œå¯ç”¨äº DOM æ“ä½œ

### æ•°æ®ä¼ é€’

- **`props`**: ä¼ é€’ç»™è¿œç¨‹ç»„ä»¶çš„å±æ€§å¯¹è±¡
- æˆ–è€…ç›´æ¥ä¼ é€’å±æ€§ï¼Œå¦‚ `userId={'123'}`

## createRemoteAppComponent API å‚è€ƒ

### å‡½æ•°ç­¾å

```tsx
function createRemoteAppComponent<T = Record<string, unknown>, E extends keyof T = keyof T>(
  config: RemoteComponentParams<T, E>
): React.ForwardRefExoticComponent<
  Omit<RemoteComponentProps<T>, "ref"> & React.RefAttributes<HTMLDivElement>
>
```

### RemoteComponentParams\<T, E\>

é…ç½®å‚æ•°æ¥å£ï¼š

```tsx
interface RemoteComponentParams<T = Record<string, unknown>, E extends keyof T = keyof T> {
  // è¿œç¨‹æ¨¡å—åŠ è½½å™¨
  loader: () => Promise<T>;
  
  // åŠ è½½çŠ¶æ€æ˜¾ç¤ºå†…å®¹
  loading: React.ReactNode;
  
  // é”™è¯¯å›é€€ç»„ä»¶
  fallback: React.ComponentType<{ error: Error }>;
  
  // å¯¼å‡ºåç§°ï¼ˆå¯é€‰ï¼‰
  export?: E;
  
  // ä¼ é€’ç»™è¿œç¨‹ç»„ä»¶çš„å±æ€§ï¼ˆå¯é€‰ï¼‰
  props?: T;
}
```

### RemoteComponentProps\<T\>

è¿”å›ç»„ä»¶çš„å±æ€§æ¥å£ï¼š

```tsx
interface RemoteComponentProps<T = Record<string, unknown>> {
  // ä¼ é€’ç»™è¿œç¨‹ç»„ä»¶çš„å±æ€§
  props?: T;
  
  // é”™è¯¯å›é€€ç»„ä»¶
  fallback?: React.ComponentType<{ error: Error }>;
  
  // åŠ è½½çŠ¶æ€æ˜¾ç¤ºå†…å®¹
  loading?: React.ReactNode;
  
  // è·¯ç”±åŸºç¡€è·¯å¾„
  basename?: string;
  
  // å†…å­˜è·¯ç”±é…ç½®
  memoryRoute?: {
    entryPath: string;
    initialState?: Record<string, unknown>;
  };
  
  // æ ·å¼å±æ€§
  style?: React.CSSProperties;
  className?: string;
  
  // å…¶ä»–è‡ªå®šä¹‰å±æ€§
  [key: string]: unknown;
}
```

### å‚æ•°è¯¦è§£

### loader

- **ç±»å‹**: `() => Promise<T>`
- **å¿…éœ€**: æ˜¯
- **ä½œç”¨**: ç”¨äºåŠ è½½è¿œç¨‹æ¨¡å—çš„å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ª Promiseï¼Œè¯¥ Promise è§£æä¸ºè¿œç¨‹æ¨¡å—å¯¹è±¡
- **ç¤ºä¾‹**:
  ```tsx
  loader: () => loadRemote('remote1/export-app')
  loader: () => import('remote1/export-app')
  ```

### loading

- **ç±»å‹**: `React.ReactNode`
- **å¿…éœ€**: æ˜¯
- **ä½œç”¨**: åœ¨è¿œç¨‹åº”ç”¨åŠ è½½æœŸé—´æ˜¾ç¤ºçš„åŠ è½½å†…å®¹ï¼Œå¯ä»¥æ˜¯ç»„ä»¶ã€å…ƒç´ æˆ–å­—ç¬¦ä¸²
- **ç¤ºä¾‹**:
  ```tsx
  loading: <div>Loading...</div>
  loading: 'Loading remote app...'
  loading: <Spinner />
  ```

### fallback

- **ç±»å‹**: `React.ComponentType<{ error: Error }>`
- **å¿…éœ€**: æ˜¯
- **ä½œç”¨**: å½“è¿œç¨‹åº”ç”¨åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºçš„é”™è¯¯å›é€€ç»„ä»¶ï¼Œä¼šæ¥æ”¶é”™è¯¯å¯¹è±¡ä½œä¸º `error` å±æ€§
- **ç¤ºä¾‹**:
  ```tsx
  fallback: ({ error }) => <div>Error: {error.message}</div>
  fallback: ErrorBoundaryComponent
  ```

### export

- **ç±»å‹**: `E extends keyof T` (æ³›å‹çº¦æŸï¼Œé€šå¸¸æ˜¯ `string`)
- **å¿…éœ€**: å¦
- **é»˜è®¤å€¼**: `'default'`
- **ä½œç”¨**: æŒ‡å®šè¦ä½¿ç”¨çš„è¿œç¨‹æ¨¡å—å¯¼å‡ºåç§°
- **ç¤ºä¾‹**:
  
  å‡è®¾è¿œç¨‹æ¨¡å—æœ‰ä»¥ä¸‹å¯¼å‡ºï¼š
  ```tsx
  // è¿œç¨‹æ¨¡å—çš„å¯¼å‡º
  export default App;           // é»˜è®¤å¯¼å‡º
  export const provider = App;  // å‘½åå¯¼å‡º provider
  export const dashboard = Dashboard; // å‘½åå¯¼å‡º dashboard
  ```
  
  åœ¨å®¿ä¸»åº”ç”¨ä¸­å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š
  ```tsx
  // ä½¿ç”¨é»˜è®¤å¯¼å‡ºï¼ˆå¯ä»¥çœç•¥ export å‚æ•°ï¼‰
  createRemoteAppComponent({
    loader: () => loadRemote('remote1/export-app'),
    // export: 'default' // å¯ä»¥çœç•¥ï¼Œé»˜è®¤å°±æ˜¯ 'default'
  })
  
  // ä½¿ç”¨å‘½åå¯¼å‡º provider
  createRemoteAppComponent({
    loader: () => loadRemote('remote1/export-app'),
    export: 'provider'
  })
  
  // ä½¿ç”¨å‘½åå¯¼å‡º dashboard
  createRemoteAppComponent({
    loader: () => loadRemote('remote1/export-app'),
    export: 'dashboard'
  })
  ```