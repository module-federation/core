# API Reference

This chapter provides detailed documentation for all React Bridge APIs.

## createBridgeComponent

`createBridgeComponent` is used to export remote React components.

```tsx
/**
 * Create Bridge Component for remote loading
 * @param bridgeInfo - Bridge Component configuration information
 * @returns Returns a function that provides render and destroy methods
 */
function createBridgeComponent<T>(
  bridgeInfo: ProviderFnParams<T>
): () => {
  render(info: RenderFnParams): Promise<void>;
  destroy(info: DestroyParams): Promise<void>;
};
```

### ProviderFnParams

Bridge Component configuration information:

```tsx
interface ProviderFnParams<T> {
  /** Root component to be remotely loaded */
  rootComponent: React.ComponentType<T>;

  /**
   * Custom render function for custom rendering logic
   * @param App - React element
   * @param id - DOM element or string ID
   * @returns React root element or Promise
   */
  render?: (
    App: React.ReactElement,
    id?: HTMLElement | string,
  ) => RootType | Promise<RootType>;

  /**
   * Custom createRoot function for React 18 and above
   * @param container - DOM container
   * @param options - CreateRoot options
   * @returns React root node
   */
  createRoot?: (
    container: Element | DocumentFragment,
    options?: CreateRootOptions,
  ) => Root;

  /**
   * Default createRoot options for React 18 and 19
   * These options will be used when creating root nodes, unless overridden by rootOptions in render parameters
   * @example
   * {
   *   identifierPrefix: 'app-',
   *   onRecoverableError: (err) => console.error(err)
   * }
   */
  defaultRootOptions?: CreateRootOptions;
}
```

### Usage Example

```tsx
import { createBridgeComponent } from '@module-federation/bridge-react';

export default createBridgeComponent({
  rootComponent: App,
  // Optional: custom default createRoot options (React 18+)
  defaultRootOptions: {
    identifierPrefix: 'my-app-',
    onRecoverableError: (error) => console.error(error)
  }
});
```

## createRemoteAppComponent

`createRemoteAppComponent` is used to load remote React components.

```tsx
/**
 * Create remote React component
 * @param options - Remote component configuration options
 * @returns Returns a React component that can receive props and render remote components
 */
function createRemoteAppComponent<T, E extends keyof T = 'default'>(
  options: RemoteComponentParams<T, E>
): React.ForwardRefExoticComponent<
  React.PropsWithoutRef<RemoteComponentProps> & React.RefAttributes<HTMLDivElement>
>;
```

### RemoteComponentParams

Remote component configuration parameters:

```tsx
interface RemoteComponentParams<
  T = Record<string, unknown>,
  E extends keyof T = keyof T
> {
  /**
   * Function to load remote module
   * Example: () => loadRemote('remote1/export-app') or () => import('remote1/export-app')
   */
  loader: () => Promise<T>;

  /** Component displayed when loading remote module */
  loading: React.ReactNode;

  /** Error component displayed when loading or rendering remote module fails */
  fallback: React.ComponentType<{ error: Error }>;

  /**
   * Specify module export name
   * Default is 'default'
   */
  export?: E;
}
```

### RemoteComponentProps

Remote component properties:

```tsx
interface RemoteComponentProps<T = Record<string, unknown>> {
  /** Properties passed to remote component */
  props?: T;

  /**
   * Memory routing configuration for controlling sub-application routing as memoryRouter
   * Will not directly display URL in browser address bar
   */
  memoryRoute?: { entryPath: string };

  /** Base pathname */
  basename?: string;

  /** Styles */
  style?: React.CSSProperties;

  /** Class name */
  className?: string;

  /** React 18+ createRoot options, will override default options */
  rootOptions?: CreateRootOptions;
}
```

### Usage Example

```tsx
import { createRemoteAppComponent } from '@module-federation/bridge-react';
import { loadRemote } from '@module-federation/runtime';

const RemoteApp = createRemoteAppComponent({
  loader: () => loadRemote('remote1/export-app'),
  loading: <div>Loading...</div>,
  fallback: ({ error }) => <div>Error: {error.message}</div>,
  export: 'default' // Optional, default is 'default'
});

// Use component
<RemoteApp
  basename="/remote1"
  className="remote-app"
  style={{ minHeight: '400px' }}
  props={{ message: 'Hello from host!' }}
  rootOptions={{ // React 18+ options
    identifierPrefix: 'remote-',
    onRecoverableError: console.error
  }}
/>
```

## React 18/19 CreateRoot Options

For React 18 and 19, supports passing `createRoot` options:

### CreateRootOptions

```tsx
interface CreateRootOptions {
  /**
   * Optional string prefix that React uses for generating IDs generated by useId.
   * Used to avoid conflicts between multiple root elements.
   */
  identifierPrefix?: string;

  /**
   * Optional callback called when React automatically recovers from errors.
   */
  onRecoverableError?: (error: unknown) => void;
}
```

### Configuration Methods

1. **Set default options when creating createBridgeComponent**:

```tsx
export default createBridgeComponent({
  rootComponent: App,
  defaultRootOptions: {
    identifierPrefix: 'my-app-',
    onRecoverableError: (error) => console.error('Recoverable error:', error)
  }
});
```

2. **Override options when using RemoteApp**:

```tsx
<RemoteApp
  rootOptions={{
    identifierPrefix: 'instance-',
    onRecoverableError: (error) => console.error('Instance error:', error)
  }}
/>
```

The `rootOptions` passed during rendering will override the `defaultRootOptions` set when creating the component.

## createLazyComponent

`createLazyComponent` is an advanced API provided through runtime plugins for component-level lazy loading.

:::info Prerequisites
Using `createLazyComponent` requires registering the `lazyLoadComponentPlugin` plugin first.
:::

### Register Plugin

```tsx
import { getInstance } from '@module-federation/runtime';
import { lazyLoadComponentPlugin } from '@module-federation/bridge-react';

// Register plugin
const instance = getInstance();
instance.registerPlugins([lazyLoadComponentPlugin()]);
```

### API Signature

```tsx
/**
 * Create lazy loading component
 * @param options - Lazy loading component configuration options
 * @returns Returns a React component
 */
function createLazyComponent<T>(
  options: LazyComponentOptions<T>
): React.ComponentType<T>;
```

### LazyComponentOptions

```tsx
interface LazyComponentOptions<T = Record<string, unknown>> {
  /**
   * Function to load remote module
   * Example: () => loadRemote('remote/component') or () => import('remote/component')
   */
  loader: () => Promise<{ default: React.ComponentType<T> } | React.ComponentType<T>>;

  /** Component displayed when loading */
  loading?: React.ReactNode;

  /** Error component displayed when loading fails */
  fallback?: React.ComponentType<{ error: Error }>;

  /** 
   * Specify module export name
   * Default is 'default'
   */
  export?: string;
}
```

### Usage Example

```tsx
import { getInstance } from '@module-federation/runtime';
import { lazyLoadComponentPlugin } from '@module-federation/bridge-react';
import { loadRemote } from '@module-federation/runtime';

// 1. Register plugin
const instance = getInstance();
instance.registerPlugins([lazyLoadComponentPlugin()]);

// 2. Create lazy loading components
const LazyButton = instance.createLazyComponent({
  loader: () => loadRemote('remote/Button'),
  loading: <div>Loading Button...</div>,
  fallback: ({ error }) => <div>Failed to load: {error.message}</div>,
});

const LazyHeader = instance.createLazyComponent({
  loader: () => loadRemote('remote/components'),
  export: 'Header', // Use named export
  loading: <div>Loading Header...</div>,
  fallback: ({ error }) => <div>Error: {error.message}</div>,
});

// 3. Use components
function App() {
  return (
    <div>
      <LazyHeader title="My App" />
      <LazyButton onClick={() => console.log('clicked')}>
        Click me
      </LazyButton>
    </div>
  );
}
```

### Differences from createRemoteAppComponent

<div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px', marginTop: '16px' }}>

<div style={{ 
  border: '1px solid #e1e4e8', 
  borderRadius: '8px', 
  padding: '16px',
  backgroundColor: '#f8f9fa'
}}>
  <h4 style={{ margin: '0 0 12px 0', color: '#0969da' }}>createLazyComponent</h4>
  <ul style={{ margin: 0, paddingLeft: '16px' }}>
    <li><strong>Purpose:</strong> Component-level lazy loading</li>
    <li><strong>Route handling:</strong> Does not handle routing</li>
    <li><strong>Registration requirement:</strong> Requires runtime plugin registration</li>
    <li><strong>Use case:</strong> Loading individual components</li>
    <li><strong>Error boundary:</strong> Requires manual handling</li>
  </ul>
</div>

<div style={{ 
  border: '1px solid #e1e4e8', 
  borderRadius: '8px', 
  padding: '16px',
  backgroundColor: '#f8f9fa'
}}>
  <h4 style={{ margin: '0 0 12px 0', color: '#0969da' }}>createRemoteAppComponent</h4>
  <ul style={{ margin: 0, paddingLeft: '16px' }}>
    <li><strong>Purpose:</strong> Application-level lazy loading</li>
    <li><strong>Route handling:</strong> Automatically handles basename and routing context</li>
    <li><strong>Registration requirement:</strong> No plugin registration required</li>
    <li><strong>Use case:</strong> Loading entire applications or application fragments</li>
    <li><strong>Error boundary:</strong> Built-in error handling</li>
  </ul>
</div>

</div>

### Best Practices

1. **Error Handling**:
```tsx
const MyComponent = instance.createLazyComponent({
  loader: () => loadRemote('remote/Component'),
  fallback: ({ error }) => {
    console.error('Component load failed:', error);
    return <div>Component loading failed, please try again later</div>;
  },
});
```

2. **Data Prefetch Optimization**:
```tsx
// Can combine with prefetch for data prefetching
instance.prefetch({ 
  id: 'remote/Component',
  preloadComponentResource: true 
});

const MyComponent = instance.createLazyComponent({
  loader: () => loadRemote('remote/Component'),
});
```

3. **TypeScript Support**:
```tsx
interface ButtonProps {
  children: React.ReactNode;
  onClick: () => void;
}

const LazyButton = instance.createLazyComponent<ButtonProps>({
  loader: () => loadRemote('remote/Button'),
  loading: <div>Loading...</div>,
});
```

## Data Prefetch Functionality

React Bridge also supports resource data prefetch functionality, see [Data Prefetch Optimization](./data-prefetch) for details.

Main features include:
- Remote module data prefetch
- Component-level data prefetch
- Smart caching strategy

For detailed usage methods, please refer to: [Data Prefetch Optimization](./data-prefetch).
