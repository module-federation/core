# Data Prefetch

React Bridge has built-in powerful data prefetch capabilities to help you optimize the loading performance of remote applications and components, improving user experience.

## Data Prefetch Overview

Data prefetch functionality allows you to start loading remote resources before users actually need them, thereby reducing user wait times. React Bridge supports the following types of data prefetch:

- **Remote Application Data Prefetch** - Preload entire remote applications
- **Remote Component Data Prefetch** - Preload individual remote components  
- **Dependency Resource Data Prefetch** - Prefetch CSS, JS and other static resources
- **Smart Data Prefetch Strategy** - Predictive loading based on user behavior

## Basic Usage

Register the lazyLoadComponentPlugin plugin at runtime to register createLazyComponent and prefetch APIs.

import { Steps, Tab, Tabs } from '@theme';

<Tabs>
  <Tab label="Build Plugin(Use build plugin)">

```ts
import { getInstance } from '@module-federation/runtime';
import { lazyLoadComponentPlugin } from '@module-federation/bridge-react';

const instance = getInstance();
instance.registerPlugins([lazyLoadComponentPlugin()])

// After registration, you can use the `createLazyComponent` and `prefetch` APIs.
instance.prefetch({
  id: 'dynamic_remote'
});

const LazyComponent = instance.createLazyComponent({
  loader: () => loadRemote('dynamic_remote'),
  loading: 'loading...',
  fallback: ({ error }) => {
    if (error instanceof Error && error.message.includes('not exist')) {
      return <div>fallback - not existed id</div>;
    }
    return <div>fallback</div>;
  },
});

```
  </Tab>
  <Tab label="Pure Runtime(Not use build plugin)">

```ts
import { createInstance } from '@module-federation/runtime';
import { lazyLoadComponentPlugin } from '@module-federation/bridge-react';

const instance = createInstance({
  name: 'host',
  remotes,
  // Register lazyLoadComponentPlugin plugin
  plugins: [lazyLoadComponentPlugin()]
});

// After registration, you can use the `createLazyComponent` and `prefetch` APIs.
instance.prefetch({
  id: 'dynamic_remote'
});

const LazyComponent = instance.createLazyComponent({
  loader: () => loadRemote('dynamic_remote'),
  loading: 'loading...',
  fallback: ({ error }) => {
    if (error instanceof Error && error.message.includes('not exist')) {
      return <div>fallback - not existed id</div>;
    }
    return <div>fallback</div>;
  },
});

```
  </Tab>
</Tabs>


## prefetch API
import Collapse from '@components/Collapse'

> This API requires the [`lazyLoadComponentPlugin` plugin to be registered](#basic-usage) before it can be called.

<Collapse>
```ts
type PrefetchOptions = {
  id: string;
  dataFetchParams?: DataFetchParams;
  preloadComponentResource?: boolean;
};
type DataFetchParams = {
  isDowngrade: boolean;
  _id?: string;
} & Record<string, unknown>;
```
</Collapse>

Preload component resource files and component data loader.

```ts
import React, { FC, memo, useEffect } from 'react';
import { getInstance } from '@module-federation/enhanced/runtime';

const instance = getInstance();

instance.prefetch({
  id: 'remote/Image',
  preloadComponentResource: true,
});
```

### id

- Type: `string`
- Required: Yes
- Default: `undefined`

The id of the component to preload.

### preloadComponentResource

- Type: `boolean`
- Required: No
- Default: `false`

Whether to preload component resource files.

### dataFetchParams

- Type: `DataFetchParams`
- Required: No
- Default: `undefined`

If the remote component has a data fetching function, this will be passed to the data fetching function when set.

