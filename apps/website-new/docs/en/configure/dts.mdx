# dts

- Type: `boolean | PluginDtsOptions`
- Required: No
- Default value: `true`
- Usage scenario: used to control `Module Federation` generation/consumption type behavior

After configuration, the producer will automatically generate a compressed type file `@mf-types.zip` (default name) during build, and the consumer will automatically pull the type file of `remotes` and decompress it to `@mf-types` (default name).

## TypeScript Interface

```ts
/**
 * TypeScript declaration options
 */
interface PluginDtsOptions {
  /**
   * Whether to generate types for exposed modules.
   * @default true
   */
  generateTypes?: boolean | DtsRemoteOptions;
  
  /**
   * Whether to consume types from remote modules.
   * @default true
   */
  consumeTypes?: boolean | DtsHostOptions;
  
  /**
   * Path to TypeScript configuration file.
   * @default path.join(process.cwd(), './tsconfig.json')
   */
  tsConfigPath?: string;
  
  /**
   * Custom implementation of the DTS plugin.
   */
  implementation?: string;
  
  /**
   * Working directory to run the compiler.
   */
  cwd?: string;
  
  /**
   * Whether to display errors in terminal.
   * @default true
   */
  displayErrorInTerminal?: boolean;
  
  /**
   * Extra options for the DTS plugin.
   */
  extraOptions?: Record<string, any>;
}

/**
 * Options for generating types in remote (producer) applications
 */
interface DtsRemoteOptions {
  /**
   * Path to TypeScript configuration file.
   */
  tsConfigPath?: string;
  
  /**
   * Directory to store generated types.
   * @default '@mf-types'
   */
  typesFolder?: string;
  
  /**
   * Compiled types folder path.
   */
  compiledTypesFolder?: string;
  
  /**
   * Whether to delete the types folder after generation.
   * @default true
   */
  deleteTypesFolder?: boolean;
  
  /**
   * Additional files to include in compilation.
   */
  additionalFilesToCompile?: string[];
  
  /**
   * Whether to compile in a child process.
   * @default true
   */
  compileInChildProcess?: boolean;
  
  /**
   * TypeScript compiler instance to use.
   * @default 'tsc'
   */
  compilerInstance?: 'tsc' | 'vue-tsc' | 'tspc' | string;
  
  /**
   * Whether to generate API types for Federation Runtime.
   * @default true
   */
  generateAPITypes?: boolean;
  
  /**
   * Whether to extract third-party package types.
   */
  extractThirdParty?: boolean | {
    exclude?: Array<string | RegExp>;
  };
  
  /**
   * Whether to extract remote types when re-exporting.
   */
  extractRemoteTypes?: boolean;
  
  /**
   * Whether to abort the build on type generation errors.
   * @default false
   */
  abortOnError?: boolean;
}

/**
 * Options for consuming types in host (consumer) applications
 */
interface DtsHostOptions {
  /**
   * Directory to store consumed types.
   * @default '@mf-types'
   */
  typesFolder?: string;
  
  /**
   * Whether to abort the build on type consumption errors.
   * @default false
   */
  abortOnError?: boolean;
  
  /**
   * Directory name for remote types.
   * @default '@mf-types'
   */
  remoteTypesFolder?: string;
  
  /**
   * Whether to delete the types folder before consumption.
   * @default true
   */
  deleteTypesFolder?: boolean;
  
  /**
   * Maximum number of retries for failed type loading.
   * @default 3
   */
  maxRetries?: number;
  
  /**
   * Whether to generate API types for Federation Runtime.
   * @default true
   */
  consumeAPITypes?: boolean;
  
  /**
   * Runtime packages to include in type generation.
   */
  runtimePkgs?: string[];
  
  /**
   * Custom URLs for remote type files.
   */
  remoteTypeUrls?: (() => Promise<RemoteTypeUrls>) | RemoteTypeUrls;
  
  /**
   * Timeout for type file requests in milliseconds.
   */
  timeout?: number;
  
  /**
   * Whether to generate types on build.
   */
  typesOnBuild?: boolean;
}

/**
 * Remote type URL configuration
 */
interface RemoteTypeUrls {
  [remoteName: string]: RemoteTypeUrl;
}

/**
 * Individual remote type URL configuration
 */
interface RemoteTypeUrl {
  /**
   * Alias for the remote.
   */
  alias?: string;
  
  /**
   * URL to the API types file (.d.ts).
   */
  api: string;
  
  /**
   * URL to the zipped types file (.zip).
   */
  zip: string;
}
```

## Configuration Examples

### Boolean Configuration

```ts
const config: ModuleFederationPluginOptions = {
  name: 'app',
  dts: true // Enable with defaults
};
```

### Basic Object Configuration

```ts
const config: ModuleFederationPluginOptions = {
  name: 'producer',
  dts: {
    generateTypes: true,
    consumeTypes: false,
    tsConfigPath: './tsconfig.build.json'
  }
};
```

### Advanced Producer Configuration

```ts
const config: ModuleFederationPluginOptions = {
  name: 'producer',
  dts: {
    generateTypes: {
      typesFolder: '@mf-types',
      generateAPITypes: true,
      extractThirdParty: true,
      extractRemoteTypes: true,
      compilerInstance: 'tsc',
      abortOnError: false
    }
  }
};
```

### Advanced Consumer Configuration

```ts
const config: ModuleFederationPluginOptions = {
  name: 'consumer',
  dts: {
    consumeTypes: {
      typesFolder: '@mf-types',
      maxRetries: 5,
      remoteTypeUrls: {
        'my-remote': {
          api: 'http://localhost:3001/@mf-types.d.ts',
          zip: 'http://localhost:3001/@mf-types.zip'
        }
      }
    }
  }
};
```

### generateTypes

- Type: `boolean | DtsRemoteOptions`
- Required: No
- Default value: `true`
- Usage scenario: used to control `Module Federation` generation type behavior

The `DtsRemoteOptions` types are as follows:

```ts
interface DtsRemoteOptions {
  tsConfigPath?: string;
  typesFolder?: string;
  deleteTypesFolder?: boolean;
  additionalFilesToCompile?: string[];
  compilerInstance?: 'tsc' | 'vue-tsc';
  compileInChildProcess?: boolean;
  generateAPITypes?: boolean;
  extractThirdParty?: boolean;
  extractRemoteTypes?: boolean;
  abortOnError?: boolean;
}
```

When configuring `generateTypes` to `true`, the following configuration will be generated by default:

```json
{
  "generateAPITypes": true,
  "abortOnError": false,
  "extractThirdParty": false,
  "extractRemoteTypes": false,
  "compileInChildProcess": true
}
```

#### extractRemoteTypes

- Type: `boolean`
- Required: No
- Default value: `undefined`
- Usage scenario: When the content of the producer `exposes` has its own `remotes` module that re-exports itself, then `extractRemoteTypes: true` can ensure that the consumer can normally obtain the module type of the producer `exposes`
- Example: [Nested type re-export](../guide/basic/type-prompt#Nested type re-export)

Whether to extract the type of `remotes`.

#### extractThirdParty

- Type: `boolean`
- Required: No
- Default value: `undefined`
- Usage scenario: When the content of the producer `exposes` contains a module containing `antd`, and the consumer does not have `antd` installed, then `extractThirdParty: true` can ensure that the consumer can normally obtain the module of the producer `exposes` type
- Example: [Third-party package type extraction](../guide/basic/type-prompt#Third-party package type extraction)

Whether to extract third-party package types.

#### generateAPITypes

- Type: `boolean`
- Required: No
- Default value: `undefined`
- Example: [Federation Runtime API type prompt](../guide/basic/type-prompt#federation-runtime-api-type-prompt)

Whether to generate the `loadRemote` type in `Federation Runtime`

#### compileInChildProcess

- Type: `boolean`
- Required: No
- Default value: `undefined`

Whether generate types in child process

#### abortOnError

- Type: `boolean`
- Required: No
- Default value: `false`

Whether to throw an error when a problem is encountered during type generation

#### tsConfigPath

- Type: `string`
- Required: No
- Default value: `path.join(process.cwd(),'./tsconfig.json')`
> priority: dts.generateTypes.tsConfigPath > dts.tsConfigPath
tsconfig configuration file path

#### typesFolder

- Type: `string`
- Required: No
- Default value: `'@mf-types'`

The name of the generated compression type file. For example, if typesFolder is set to `custom`, then the name of the generated compression type file is: `custom.zip`

#### deleteTypesFolder

- Type: `boolean`
- Required: No
  -Default: `true`

Whether to delete the generated type folder

#### compilerInstance

- Type: `'tsc' | 'vue-tsc' | 'tspc' | string`
- Required: No
- Default value: `'tsc'`

Instance of compiled type

### consumeTypes

- Type: `boolean | DtsHostOptions`
- Required: No
- Default value: `true`
- Usage scenario: used to control `Module Federation` consumption (loading) type behavior

The `DtsHostOptions` types are as follows:

```ts
interface DtsHostOptions {
  typesFolder?: string;
  abortOnError?: boolean;
  remoteTypesFolder?: string;
  deleteTypesFolder?: boolean;
  maxRetries?: number;
  consumeAPITypes?: boolean;
}
```

When configuring `consumeTypes` to `true`, the following configuration will be generated by default:

```json
{
  "abortOnError": false,
  "consumeAPITypes": true
}
```

#### consumeAPITypes

- Type: `boolean`
- Required: No
- Default value: `true`
- Example: [Federation Runtime API type prompt](../guide/basic/type-prompt#federation-runtime-api-type-prompt)

Whether to generate the type of runtime `loadRemote` API

#### maxRetries

- Type: `number`
- Required: No
- Default value: `3`

Maximum number of retries for failed loading

#### abortOnError

- Type: `boolean`
- Required: No
- Default value: `false`

Whether to throw an error when a problem is encountered during type loading

#### typesFolder

- Type: `string`
- Required: No
- Default value: `'@mf-types'`

Type storage directory after successful loading

#### deleteTypesFolder

- Type: `boolean`
- Required: No
- Default value: `true`

Before loading type files, whether to delete the previously loaded `typesFolder` directory

#### remoteTypesFolder

- Type: `string`
- Required: No
- Default value: `'@mf-types'`

`typesFolder` corresponding to `remotes` directory configuration

#### remoteTypeUrls

- Type: `(() => Promise<RemoteTypeUrls>) | RemoteTypeUrls`
- Required: No
- Default value:`undefined`

Used for getting the address of the `remote` type file.

Application scenarios:

* Only the runtime API is used to load the producer, and no build plugin is used. The MF type file address is informed by creating a `module-federation.config.ts` configuration file and setting this configuration.

```ts title="module-federation.config.ts"
import { createModuleFederationConfig, type moduleFederationPlugin } from '@module-federation/enhanced';

export default createModuleFederationConfig({
  // ...
  remotes: {
    'remote1-alias': 'remote1@http://localhost:80801/remoteEntry.js'
  },
  dts:{
    consumeTypes:{
      remoteTypeUrls: async (): Promise<moduleFederationPlugin.RemoteTypeUrls> => {
        // Simulate the request interface to obtain the type file address
        const data = await new Promise<moduleFederationPlugin.RemoteTypeUrls>((resolve) => {
          setTimeout(() => {
            resolve({
              remote1:{
                alias: 'remote1-alias',
                api:'http://localhost:8081/custom-dir/@mf-types.d.ts',
                zip:'http://localhost:8081/custom-dir/@mf-types.zip'
              }
            });
          },1000)
        });

        return data;
      }
    }
  }
});
```


* When remote is `remoteEntry.js`, the type file address usually directly replaces the js file with the corresponding type file, such as `@mf-types.zip`, but the actual uploaded type file address is not this, so you can tell MF the real type file address by setting this configuration.

```ts title="module-federation.config.ts"
import { createModuleFederationConfig } from '@module-federation/enhanced';

export default createModuleFederationConfig({
  // ...
  remotes: {
    'remote1-alias': 'remote1@http://localhost:80801/remoteEntry.js'
  },
  dts:{
    consumeTypes:{
      remoteTypeUrls: {
        // remote name
        remote1:{
          alias: 'remote1-alias',
          api:'http://localhost:8081/custom-dir/@mf-types.d.ts',
          zip:'http://localhost:8081/custom-dir/@mf-types.zip'
        }
      }
    }
  }
});
```

### tsConfigPath

- Type: `string`
- Required: No
- Default value: `path.join(process.cwd(),'./tsconfig.json')`

tsconfig configuration file path

### cwd

- Type: `string`
- Required: No
- Default value: `undefined`

The working directory to run the compiler

### displayErrorInTerminal

- Type: `boolean`
- Required: No
- Default value: `true`

Whether print error log in terminal
