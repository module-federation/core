{"version":3,"sources":["../../../../../packages/typescript/src/plugins/FederatedTypesStatsPlugin.ts"],"sourcesContent":["import { Compilation, Compiler, sources } from 'webpack';\nimport { generateTypesStats } from '../lib/generateTypesStats';\n\nimport { NormalizeOptions } from '../lib/normalizeOptions';\nimport { CompilationParams, TypesStatsJson } from '../types';\n\nconst PLUGIN_NAME = 'FederatedTypesStatsPlugin';\n\nexport class FederatedTypesStatsPlugin {\n  constructor(private options: NormalizeOptions) {}\n\n  apply(compiler: Compiler) {\n    compiler.hooks.thisCompilation.tap(PLUGIN_NAME, (compilation, params) => {\n      const federatedTypesMap = (params as CompilationParams).federated_types;\n\n      compilation.hooks.processAssets.tap(\n        {\n          name: PLUGIN_NAME,\n          stage: Compilation.PROCESS_ASSETS_STAGE_ANALYSE,\n        },\n        () => {\n          const { typesIndexJsonFilePath, publicPath } = this.options;\n\n          const statsJson: TypesStatsJson = {\n            publicPath,\n            files: generateTypesStats(federatedTypesMap, this.options),\n          };\n\n          const source = new sources.RawSource(JSON.stringify(statsJson));\n\n          const asset = compilation.getAsset(typesIndexJsonFilePath);\n\n          if (asset) {\n            compilation.updateAsset(typesIndexJsonFilePath, source);\n          } else {\n            compilation.emitAsset(typesIndexJsonFilePath, source);\n          }\n        }\n      );\n    });\n  }\n}\n"],"names":["FederatedTypesStatsPlugin","PLUGIN_NAME","apply","compiler","hooks","thisCompilation","tap","compilation","params","federatedTypesMap","federated_types","processAssets","name","stage","Compilation","PROCESS_ASSETS_STAGE_ANALYSE","typesIndexJsonFilePath","publicPath","options","statsJson","files","generateTypesStats","source","sources","RawSource","JSON","stringify","asset","getAsset","updateAsset","emitAsset","constructor"],"mappings":";;;;+BAQaA;;;eAAAA;;;yBARkC;oCACZ;AAKnC,MAAMC,cAAc;AAEb,IAAA,AAAMD,4BAAN,MAAMA;IAGXE,MAAMC,QAAkB,EAAE;QACxBA,SAASC,KAAK,CAACC,eAAe,CAACC,GAAG,CAACL,aAAa,CAACM,aAAaC,SAAW;YACvE,MAAMC,oBAAoB,AAACD,OAA6BE,eAAe;YAEvEH,YAAYH,KAAK,CAACO,aAAa,CAACL,GAAG,CACjC;gBACEM,MAAMX;gBACNY,OAAOC,oBAAW,CAACC,4BAA4B;YACjD,GACA,IAAM;gBACJ,MAAM,EAAEC,uBAAsB,EAAEC,WAAU,EAAE,GAAG,IAAI,CAACC,OAAO;gBAE3D,MAAMC,YAA4B;oBAChCF;oBACAG,OAAOC,IAAAA,sCAAkB,EAACZ,mBAAmB,IAAI,CAACS,OAAO;gBAC3D;gBAEA,MAAMI,SAAS,IAAIC,gBAAO,CAACC,SAAS,CAACC,KAAKC,SAAS,CAACP;gBAEpD,MAAMQ,QAAQpB,YAAYqB,QAAQ,CAACZ;gBAEnC,IAAIW,OAAO;oBACTpB,YAAYsB,WAAW,CAACb,wBAAwBM;gBAClD,OAAO;oBACLf,YAAYuB,SAAS,CAACd,wBAAwBM;gBAChD,CAAC;YACH;QAEJ;IACF;IA/BAS,YAAoBb,QAA2B;uBAA3BA;IAA4B;AAgClD"}