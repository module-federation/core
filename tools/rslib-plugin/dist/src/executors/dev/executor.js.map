{"version":3,"file":"executor.js","names":[],"sources":["../../../../src/executors/dev/executor.ts"],"sourcesContent":["import type { ExecutorContext } from '@nx/devkit';\nimport { spawn } from 'child_process';\nimport { join } from 'path';\n\nexport interface RslibDevExecutorOptions {\n  configFile?: string;\n  port?: number;\n  host?: string;\n  open?: boolean;\n  mode?: 'watch' | 'mf-dev';\n  verbose?: boolean;\n}\n\nexport default async function rslibDevExecutor(\n  options: RslibDevExecutorOptions,\n  context: ExecutorContext,\n): Promise<{ success: boolean }> {\n  const projectRoot =\n    context.projectGraph?.nodes[context.projectName!]?.data?.root;\n\n  if (!projectRoot) {\n    throw new Error(`Could not find project root for ${context.projectName}`);\n  }\n\n  console.info(`Starting rslib dev server for ${context.projectName}...`);\n\n  if (options.verbose) {\n    console.info(`Options: ${JSON.stringify(options, null, 2)}`);\n    console.info(`Project root: ${projectRoot}`);\n    console.info(`Workspace root: ${context.root}`);\n  }\n\n  return new Promise<{ success: boolean }>((resolve) => {\n    // Construct the rslib command based on mode\n    const args = ['rslib'];\n\n    if (options.mode === 'watch') {\n      args.push('build', '--watch');\n    } else {\n      args.push('mf-dev'); // Default to mf-dev for Module Federation development\n    }\n\n    if (options.configFile && options.configFile !== 'rslib.config.ts') {\n      args.push('--config', options.configFile);\n    }\n\n    if (options.port && options.mode === 'mf-dev') {\n      args.push('--port', options.port.toString());\n    }\n\n    if (options.host && options.mode === 'mf-dev') {\n      args.push('--host', options.host);\n    }\n\n    if (options.open && options.mode === 'mf-dev') {\n      args.push('--open');\n    }\n\n    const command = args[0];\n    const commandArgs = args.slice(1);\n\n    console.info(`Running: ${args.join(' ')}`);\n    console.info(`Working directory: ${join(context.root, projectRoot)}`);\n\n    const child = spawn(command, commandArgs, {\n      cwd: join(context.root, projectRoot),\n      stdio: 'inherit',\n      env: {\n        ...process.env,\n        NODE_ENV: 'development',\n      },\n    });\n\n    child.on('error', (error) => {\n      console.error('❌ Rslib dev server failed to start:', error);\n      resolve({ success: false });\n    });\n\n    child.on('exit', (code) => {\n      if (code === 0) {\n        console.info('✅ Rslib dev server stopped');\n        resolve({ success: true });\n      } else {\n        console.error(`❌ Rslib dev server exited with code ${code}`);\n        resolve({ success: false });\n      }\n    });\n\n    // Handle termination signals\n    process.on('SIGTERM', () => {\n      console.info('Received SIGTERM, stopping rslib dev server...');\n      child.kill('SIGTERM');\n    });\n\n    process.on('SIGINT', () => {\n      console.info('Received SIGINT, stopping rslib dev server...');\n      child.kill('SIGINT');\n    });\n  });\n}\n"],"mappings":";;;;AAaA,eAA8B,iBAC5B,SACA,SAC+B;CAC/B,MAAM,cACJ,QAAQ,cAAc,MAAM,QAAQ,cAAe,MAAM;AAE3D,KAAI,CAAC,YACH,OAAM,IAAI,MAAM,mCAAmC,QAAQ,cAAc;AAG3E,SAAQ,KAAK,iCAAiC,QAAQ,YAAY,KAAK;AAEvE,KAAI,QAAQ,SAAS;AACnB,UAAQ,KAAK,YAAY,KAAK,UAAU,SAAS,MAAM,EAAE,GAAG;AAC5D,UAAQ,KAAK,iBAAiB,cAAc;AAC5C,UAAQ,KAAK,mBAAmB,QAAQ,OAAO;;AAGjD,QAAO,IAAI,SAA+B,YAAY;EAEpD,MAAM,OAAO,CAAC,QAAQ;AAEtB,MAAI,QAAQ,SAAS,QACnB,MAAK,KAAK,SAAS,UAAU;MAE7B,MAAK,KAAK,SAAS;AAGrB,MAAI,QAAQ,cAAc,QAAQ,eAAe,kBAC/C,MAAK,KAAK,YAAY,QAAQ,WAAW;AAG3C,MAAI,QAAQ,QAAQ,QAAQ,SAAS,SACnC,MAAK,KAAK,UAAU,QAAQ,KAAK,UAAU,CAAC;AAG9C,MAAI,QAAQ,QAAQ,QAAQ,SAAS,SACnC,MAAK,KAAK,UAAU,QAAQ,KAAK;AAGnC,MAAI,QAAQ,QAAQ,QAAQ,SAAS,SACnC,MAAK,KAAK,SAAS;EAGrB,MAAM,UAAU,KAAK;EACrB,MAAM,cAAc,KAAK,MAAM,EAAE;AAEjC,UAAQ,KAAK,YAAY,KAAK,KAAK,IAAI,GAAG;AAC1C,UAAQ,KAAK,qCAA2B,QAAQ,MAAM,YAAY,GAAG;EAErE,MAAM,iCAAc,SAAS,aAAa;GACxC,oBAAU,QAAQ,MAAM,YAAY;GACpC,OAAO;GACP,KAAK;IACH,GAAG,QAAQ;IACX,UAAU;IACX;GACF,CAAC;AAEF,QAAM,GAAG,UAAU,UAAU;AAC3B,WAAQ,MAAM,uCAAuC,MAAM;AAC3D,WAAQ,EAAE,SAAS,OAAO,CAAC;IAC3B;AAEF,QAAM,GAAG,SAAS,SAAS;AACzB,OAAI,SAAS,GAAG;AACd,YAAQ,KAAK,6BAA6B;AAC1C,YAAQ,EAAE,SAAS,MAAM,CAAC;UACrB;AACL,YAAQ,MAAM,uCAAuC,OAAO;AAC5D,YAAQ,EAAE,SAAS,OAAO,CAAC;;IAE7B;AAGF,UAAQ,GAAG,iBAAiB;AAC1B,WAAQ,KAAK,iDAAiD;AAC9D,SAAM,KAAK,UAAU;IACrB;AAEF,UAAQ,GAAG,gBAAgB;AACzB,WAAQ,KAAK,gDAAgD;AAC7D,SAAM,KAAK,SAAS;IACpB;GACF"}